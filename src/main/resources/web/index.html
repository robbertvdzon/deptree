<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
        body {
            margin: 0;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>

<body>
test:<a href="/rest/customers/1">link</a>
<script>

    $.ajax("/rest/modulegroup/all", {
        success: function(data) {
            load(data);
        },
        error: function() {
        }
    });

    var svg = createSvg();


    function load(data) {
        var total = data.modules.length;
        var radius = 250;
        var offset = 300;

        for (i = 0; i < data.modules.length; i++) {
            var angle = (360/total)*i;
            var x = offset + radius * Math.cos(angle*Math.PI/180)
            var y = offset + radius * Math.sin(angle*Math.PI/180)
            data.modules[i].x = x;
            data.modules[i].y = y;
        }

        var moduleMap = []
        for (i = 0; i < data.modules.length; i++) {
            moduleMap[data.modules[i].name] = data.modules[i]
        }


        defineArrow();

        for (i = 0; i < data.modules.length; i++) {
            var module = data.modules[i];
            addCircle(module.x, module.y, module.name);
        }

        for (i = 0; i < data.modules.length; i++) {
            var module = data.modules[i];
            for (j = 0; j < module.dep.length; j++) {
                var depModule = moduleMap[module.dep[j]]
                addLine(module.x, module.y, depModule.x, depModule.y);

            }
        }




    }

    function createSvg() {
        return d3
            .select("body")
            .call(d3.zoom().on("zoom", function() {
                svg.attr("transform", d3.event.transform)
            }))
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .append("g")
    }

    function defineArrow() {
        svg.append("svg:defs").append("svg:marker")
            .attr("id", "triangle")
            .attr("refX", 6)
            .attr("refY", 6)
            .attr("markerWidth", 30)
            .attr("markerHeight", 30)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M 0 0 12 6 0 12 3 6")
            .style("fill", "black");
    }

    function addCircle(x, y, text) {
        svg.append("circle")
            .attr("cx", x)
            .attr("cy", y)
            .attr("r", 50)
            .style("fill", "#B8DEE6");

        svg.append("text")
            .attr("x", x)
            .attr("y", y)
            .text(text);
    }

    function addLine(x1, y1, x2, y2) {
        svg.append("line")
            .attr("x1", x1)
            .attr("y1", y1)
            .attr("x2", x2)
            .attr("y2", y2)
            .attr("stroke-width", 1)
            .attr("stroke", "black")
            .attr("marker-end", "url(#triangle)");
    }

</script>

</body>